services:
  github-runner:
    # Build the Docker image for the runner using the Dockerfile in this directory
    build:
      context: .
      args:
        # Architecture for the GitHub Actions runner binary (e.g., amd64, arm64)
        RUNNER_ARCH: ${RUNNER_ARCH}
        # Docker group ID from the host system (must match host's docker group for Docker-in-Docker)
        # You can get this value with: getent group docker | cut -d: -f3
        DOCKER_GID: ${DOCKER_GID}

    # Load default values from .env-repo file (optional)
    # These values can be overridden in Portainer
    env_file:
      - .env-repo

    # Set environment variables for the runner container
    # These variables will be visible and editable in Portainer
    # Values from .env-repo will be used as defaults, but can be overridden
    environment:
      - REPO_URL
      - ACCESS_TOKEN
      - RUNNER_NAME
      - LABELS
      - DOCKER_GID
      - RUNNER_ARCH

    # Mount the Docker socket to enable Docker-in-Docker workflows
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock

    # Automatically restart the container unless it is explicitly stopped
    restart: unless-stopped
