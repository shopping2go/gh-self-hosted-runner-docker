services:
  github-runner:
    # Build the Docker image for the runner using the Dockerfile in this directory
    build:
      context: .
      args:
        # Architecture for the GitHub Actions runner binary (e.g., amd64, arm64)
        RUNNER_ARCH: ${RUNNER_ARCH:-x64}
        # Docker group ID from the host system (must match host's docker group for Docker-in-Docker)
        # You can get this value with: getent group docker | cut -d: -f3
        DOCKER_GID: ${DOCKER_GID:-999}

    # Container name for easier management
    container_name: github-runner

      REPO_URL: ${REPO_URL:-https://github.com/your-org/your-repo}
      ACCESS_TOKEN: ${ACCESS_TOKEN:-your-token-here}
      RUNNER_NAME: ${RUNNER_NAME:-docker-runner}
      LABELS: ${LABELS:-self-hosted,docker}
      DOCKER_GID: ${DOCKER_GID:-999}
      RUNNER_ARCH: ${RUNNER_ARCH:-x64}
      # Set to 'true' to start Docker daemon inside the container (Docker-in-Docker)
      ENABLE_DIND: ${ENABLE_DIND:-false}

    # Mount the host Docker socket so the runner can use the host Docker daemon
    # (alternative to ENABLE_DIND=true, which would run a Docker daemon inside the container)
    volumes:
      RUNNER_SCOPE: ${RUNNER_SCOPE:-repos}

    # Automatically restart the container unless it is explicitly stopped
    # WARNING: This gives the container full access to the Docker daemon!
    restart: unless-stopped
      - /var/run/docker.sock:/var/run/docker.sock:rw

    # Required for ENABLE_DIND=true to run Docker daemon inside the container
    # WARNING: Privileged mode gives the container full access to the host!
    # Note: Docker Compose interprets string "true"/"false" as boolean values
    # Set ENABLE_DIND=true (without quotes) in your .env file to enable
    privileged: ${ENABLE_DIND:-false}

    # Security options (note: no-new-privileges may conflict with privileged mode)
    # security_opt:
    #   - no-new-privileges:true  # Prevent privilege escalation

    # Resource limits (adjust based on your needs)
    # Uncomment to enable resource constraints
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '2'
    #       memory: 4G
    #     reservations:
    #       cpus: '1'
    #       memory: 2G
